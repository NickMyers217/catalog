{% extends "layout.html" %}

{% block title %} Catalog {% endblock %}

{% block head %}
  {{ super() }}
  <script src="https://apis.google.com/js/platform.js"></script>
{% endblock %}
{% block content %}
  <h1>Login</h1>
  <div id="googleButton">
    <div class="g-signin2"
	 data-theme="dark"
	 data-redirecturi="postmessage"
	 data-accesstype="offline"
	 data-cookiepolicy="single_host_origin"
	 data-onsuccess="onSignIn"
	 data-onfailure="onSignInFailure">
    </div>
  </div>
  <div id="result"></div>
  <script>
    $(document).ready(function start () {
      gapi.load('auth2', function () {
        auth2 = gapi.auth2.init({
          client_id: '562432597158-ouirs3oa9papg200us2ae0rormi1hkpi.apps.googleusercontent.com'
        })
      })
    })
    
    function onSignIn (authResult) {
      if (authResult.code) {
        // Verify the token on the back end via AJAX
        $.ajax({
          type: 'POST',
          url: '/googleLogin?state={{state}}',
          processData: false,
          data: authResult.code,
          contentType: 'application/octet-stream; charset=utf-8',
          success: function (result) {
            // Handle or verify the server response if necessary.
            if (result) {
              $('#result').html('Login Successful!<br>'+ result)
            } else if (authResult.error) {
              console.log('There was an error: ' + authResult.error)
            } else {
              $('#result').html('Failed to make a server-side call.')
            }
          },
          failure: function (result) {
            console.log(result)
          }
        })
      }
    } 

    function onSignInFailure () {
      console.log('Failed to sign in!');
    }
  </script>
{% endblock %}
