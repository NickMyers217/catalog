{% extends "layout.html" %}

{% block title %} Catalog {% endblock %}

{% block head %}
  <meta name="google-signin-scope" content="profile email">
  <meta name="google-signin-client_id" content="562432597158-ouirs3oa9papg200us2ae0rormi1hkpi.apps.googleusercontent.com">
  {{ super() }}
  <script src="https://apis.google.com/js/platform.js" async defer></script>
{% endblock %}
{% block content %}
  <h1>Login</h1>
  <div id="googleButton">
    <div class="g-signin2" data-onsuccess="signInCallback"
	 data-theme="dark"
	 data-redirecturi="postmessage"
	 data-accesstype="offline"
	 data-cookiepolicy="single_host_origin"
	 data-callback="signInCallback"
	 data-approvalprompt="force">
    </div>
  </div>
  <div id="result"></div>
  <script>
    function signInCallback (googleUser) {
      console.log('Inside callback')
      var id_token = googleUser.getAuthResponse().id_token;
      console.log(id_token)

      if (id_token) {
        // Verify the token on the back end via AJAX
        $.ajax({
          type: 'POST',
          url: '/googleLogin?state={{state}}',
          processData: false,
          data: id_token,
          contentType: 'application/octet-stream; charset=utf-8',
          success: function (result) {
            // Handle or verify the server response if necessary.
            if (result) {
              $('#result').html('Login Successful!<br>'+ result)
            } else if (authResult.error) {
              console.log('There was an error: ' + authResult.error)
            } else {
              $('#result').html('Failed to make a server-side call.')
            }
          }
        })
      }
    } 
  </script>
{% endblock %}
