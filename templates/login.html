{% extends "layout.html" %}

{% block title %} Catalog {% endblock %}

{% block head %}
  {{ super() }}
  <script src="https://apis.google.com/js/platform.js" async defer></script>
{% endblock %}
{% block content %}
  <h1>Login</h1>
  <div id="googleButton">
    <span class="g-signin"
	  data-theme="dark"
	  data-scope="openid email"
	  data-clientid="562432597158-ouirs3oa9papg200us2ae0rormi1hkpi.apps.googleusercontent.com"
	  data-redirecturi="postmessage"
	  data-accesstype="offline"
	  data-cookiepolicy="single_host_origin"
	  data-callback="signInCallback"
	  data-approvalprompt="force">
    </span>
  </div>
  <div id="result"></div>
  <script>
    function signInCallback (authResult) {
      console.log('Inside callback')
      console.log(authResult)

      if (authResult.code) {
        // Verify the token on the back end via AJAX
        $.ajax({
          type: 'POST',
          url: '/googleLogin?state={{state}}',
          processData: false,
          data: authResult.code,
          contentType: 'application/octet-stream; charset=utf-8',
          success: function (result) {
            // Handle or verify the server response if necessary.
            if (result) {
              $('#result').html('Login Successful!<br>'+ result)
            } else if (authResult.error) {
              console.log('There was an error: ' + authResult.error)
            } else {
              $('#result').html('Failed to make a server-side call.')
            }
          },
          failure: function (result) {
            console.log(result)
          }
        })
      }
    } 
  </script>
{% endblock %}
